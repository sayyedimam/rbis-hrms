<div class="auth-container">
  <app-particle-bg></app-particle-bg>
  <div class="auth-card">
    <div class="auth-header">
      <div class="logo">
        <i data-lucide="shield"></i>
        <span>RBIS Tech Pvt Ltd</span>
      </div>
      <h1>Welcome Back</h1>
      <p>Enter your credentials to access the dashboard</p>
    </div>

    <form (ngSubmit)="onLogin()" #loginForm="ngForm">
      <div class="form-group">
        <label for="email">Office Email</label>
        <div class="input-wrapper">
          <i data-lucide="mail"></i>
          <input
            type="email"
            id="email"
            name="email"
            [(ngModel)]="loginData.email"
            placeholder="email@office.com"
            required
            email
            #email="ngModel"
          />
        </div>
        <div *ngIf="email.invalid && email.touched" class="field-error">
          Valid office email required
        </div>
      </div>

      <div class="form-group">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
          "
        >
          <label for="password">Password</label>
          <a
            (click)="openForgotPassword()"
            style="
              font-size: 0.85rem;
              color: var(--primary);
              cursor: pointer;
              text-decoration: none;
            "
          >
            Forgot Password?
          </a>
        </div>
        <div class="input-wrapper">
          <i data-lucide="lock"></i>
          <input
            type="password"
            id="password"
            name="password"
            [(ngModel)]="loginData.password"
            placeholder="••••••••"
            required
          />
        </div>
      </div>

      <div *ngIf="error" class="error-msg">
        <i data-lucide="alert-circle"></i>
        {{ error }}
      </div>

      <button type="submit" [disabled]="!loginForm.valid" class="btn-primary">
        <span>Login to Dashboard</span>
        <i data-lucide="arrow-right"></i>
      </button>

      <div class="auth-footer">
        Don't have an account? <a routerLink="/signup">Sign Up</a>
      </div>
    </form>
  </div>

  <!-- Forgot Password Modal -->
  <div
    class="modal-overlay"
    *ngIf="showForgotPasswordModal"
    (click)="closeForgotPassword()"
  >
    <div
      class="modal-card"
      (click)="$event.stopPropagation()"
      style="max-width: 450px"
    >
      <div class="modal-header">
        <h2>Reset Password</h2>
        <button class="close-btn" (click)="closeForgotPassword()">
          <i data-lucide="x"></i>
        </button>
      </div>

      <!-- Step 1: Enter Email -->
      <div *ngIf="forgotPasswordStep === 'email'" class="modal-body">
        <p style="color: #64748b; margin-bottom: 1.5rem">
          Enter your email address and we'll send you an OTP to reset your
          password.
        </p>
        <div class="form-group">
          <label>Email Address</label>
          <div class="input-wrapper">
            <i data-lucide="mail"></i>
            <input
              type="email"
              [(ngModel)]="forgotEmail"
              placeholder="email@office.com"
              required
            />
          </div>
        </div>
        <div *ngIf="error" class="error-msg">
          <i data-lucide="alert-circle"></i>
          {{ error }}
        </div>
        <button
          class="btn-primary"
          (click)="sendResetOtp()"
          [disabled]="!forgotEmail || loading"
        >
          <span *ngIf="!loading">Send OTP</span>
          <span *ngIf="loading">Sending...</span>
        </button>
      </div>

      <!-- Step 2: Enter OTP and New Password -->
      <div *ngIf="forgotPasswordStep === 'otp'" class="modal-body">
        <p style="color: #64748b; margin-bottom: 1.5rem">
          Enter the 6-digit OTP sent to <strong>{{ forgotEmail }}</strong>
        </p>
        <div class="form-group">
          <label>OTP Code</label>
          <div class="input-wrapper">
            <i data-lucide="key"></i>
            <input
              type="text"
              [(ngModel)]="resetOtp"
              placeholder="123456"
              maxlength="6"
              required
            />
          </div>
        </div>
        <div class="form-group">
          <label>New Password</label>
          <div class="input-wrapper">
            <i data-lucide="lock"></i>
            <input
              type="password"
              [(ngModel)]="newPassword"
              placeholder="••••••••"
              required
            />
          </div>
        </div>
        <div class="form-group">
          <label>Confirm New Password</label>
          <div class="input-wrapper">
            <i data-lucide="shield-check"></i>
            <input
              type="password"
              [(ngModel)]="confirmNewPassword"
              placeholder="••••••••"
              required
            />
          </div>
        </div>
        <div *ngIf="error" class="error-msg">
          <i data-lucide="alert-circle"></i>
          {{ error }}
        </div>
        <button
          class="btn-primary"
          (click)="resetPassword()"
          [disabled]="
            !resetOtp || !newPassword || !confirmNewPassword || loading
          "
        >
          <span *ngIf="!loading">Reset Password</span>
          <span *ngIf="loading">Resetting...</span>
        </button>
      </div>

      <!-- Step 3: Success -->
      <div
        *ngIf="forgotPasswordStep === 'success'"
        class="modal-body"
        style="text-align: center"
      >
        <div style="font-size: 3rem; color: #10b981; margin-bottom: 1rem">
          <i data-lucide="check-circle"></i>
        </div>
        <h3 style="color: #1e293b; margin-bottom: 0.5rem">
          Password Reset Successful!
        </h3>
        <p style="color: #64748b">You can now login with your new password.</p>
      </div>
    </div>
  </div>
</div>
